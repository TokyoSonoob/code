<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Purple Shop UUID Injector</title>
  <style>
    :root{
      --bg:#0b0b1a; --panel:#111327; --soft:#0d1022; --text:#e9e9f2; --muted:#9aa0b3;
      --accent:#8b5cf6; --accent-2:#3b82f6;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family: "Segoe UI", Roboto, "Noto Sans Thai", sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height:100vh;
      display:flex;flex-direction:column;
    }

    /* ‡πÅ‡∏ñ‡∏ö‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô */
    .banner{
      width:100%;
      padding:16px;
      text-align:center;
      font-size:28px;
      font-weight:900;
      text-transform:uppercase;
      background:linear-gradient(90deg, var(--accent), var(--accent-2));
      color:transparent;
      -webkit-background-clip:text;
      background-clip:text;
      letter-spacing:1px;
      text-shadow:0 2px 6px rgba(0,0,0,.6);
    }

    .wrap{max-width:960px;margin:0 auto;padding:24px;flex:1;width:100%}
    .card{background:var(--panel);border-radius:20px;padding:20px;margin-top:16px}
    .btn{background:var(--accent);color:#fff;border:none;padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:600}
    .btn:active{transform:scale(.97)}
    .drop{margin-top:12px;padding:20px;border:2px dashed var(--accent);border-radius:14px;text-align:center}
    .list{margin-top:16px}
    pre{background:#0d1130;padding:12px;border-radius:10px;overflow:auto;font-size:13px}
  </style>
</head>
<body>
  <div class="banner">üíúüíô Purple Shop ‡πÑ‡∏á‡πÑ‡∏≠‡∏™‡∏±‡∏™</div>

  <div class="wrap">
    <div class="card">
      <h2>‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î Addon manifest.json ‡∏´‡∏£‡∏∑‡∏≠ .mcpack/.mcaddon</h2>
      <div class="drop" id="drop">
        ‡∏•‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏°‡∏≤‡∏õ‡∏•‡πà‡∏≠‡∏¢‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ ‡∏´‡∏£‡∏∑‡∏≠ <button class="btn" id="pick">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå</button>
        <input type="file" id="file" multiple hidden accept=".zip,.mcpack,.mcaddon,.json">
      </div>
      <div class="list" id="list"></div>
      <h3>world_behavior_packs.json</h3>
      <pre id="outBH">[]</pre>
      <h3>world_resource_packs.json</h3>
      <pre id="outRS">[]</pre>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
  <script>
    const drop=document.getElementById('drop');
    const input=document.getElementById('file');
    const pick=document.getElementById('pick');
    const outBH=document.getElementById('outBH');
    const outRS=document.getElementById('outRS');
    const list=document.getElementById('list');
    const BH=new Map(), RS=new Map();

    pick.onclick=()=>input.click();
    input.onchange=()=>handleFiles(input.files);

    ['dragenter','dragover'].forEach(ev=>drop.addEventListener(ev,e=>{e.preventDefault();drop.style.background='#1a1b3d'}));
    ['dragleave','drop'].forEach(ev=>drop.addEventListener(ev,e=>{e.preventDefault();drop.style.background=''}));
    drop.addEventListener('drop',e=>handleFiles(e.dataTransfer.files));

    function prettySort(arr){
      return arr.sort((a,b)=>{
        const n=(a.name||'').localeCompare(b.name||'', 'th');
        if(n!==0) return n;
        return b.version.join('.').localeCompare(a.version.join('.'));
      });
    }
    function updateOutputs(){
      const bh=prettySort([...BH.values()]).map(x=>({pack_id:x.pack_id,version:x.version}));
      const rs=prettySort([...RS.values()]).map(x=>({pack_id:x.pack_id,version:x.version}));
      outBH.textContent=JSON.stringify(bh,null,2);
      outRS.textContent=JSON.stringify(rs,null,2);
    }
    async function parseManifest(txt){
      try{return JSON.parse(txt);}catch{return {}}
    }
    async function handleFiles(files){
      for(const file of files){
        if(/manifest\\.json$/i.test(file.name)){
          const text=await file.text();
          await handleManifest(await parseManifest(text),file.name);
        }else if(/\\.(zip|mcpack|mcaddon)$/i.test(file.name)){
          const zip=await JSZip.loadAsync(file);
          const entry=Object.values(zip.files).find(f=>/manifest\\.json$/i.test(f.name));
          if(entry){
            const text=await entry.async('text');
            await handleManifest(await parseManifest(text),file.name);
          }
        }
      }
      updateOutputs();
    }
    async function handleManifest(obj,from){
      const h=obj.header||{};
      const uuid=h.uuid||h.pack_id;
      const ver=h.version||[];
      const name=h.name||'unknown';
      const mods=obj.modules||[];
      if(!uuid) return;
      const pack_id=String(uuid);
      const version=Array.isArray(ver)?ver:ver.toString().split('.').map(Number);
      if(mods.some(m=>(m.type||'').toLowerCase()==='data')) BH.set(pack_id,{pack_id,version,name,from});
      if(mods.some(m=>(m.type||'').toLowerCase()==='resources')) RS.set(pack_id,{pack_id,version,name,from});
      // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠ type ‡πÄ‡∏•‡∏¢ ‚Üí ‡∏à‡∏±‡∏î‡πÄ‡∏õ‡πá‡∏ô RS ‡∏î‡∏µ‡∏ü‡∏≠‡∏•‡∏ï‡πå
      if(!mods.length) RS.set(pack_id,{pack_id,version,name,from});
      const line=document.createElement('div');
      line.textContent=`‚úî ${name} (${pack_id})`;
      list.appendChild(line);
    }
  </script>
</body>
</html>
