<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Minecraft Addon Pack Injector (BH/RS)</title>
  <meta name="theme-color" content="#0b0b1a" />
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <style>
    :root{
      --bg:#0b0b1a; --panel:#111327; --soft:#0d1022; --text:#e9e9f2; --muted:#9aa0b3;
      --accent:#8b5cf6; --accent-2:#a78bfa; --ok:#10b981; --err:#ef4444; --code:#0b1224;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      color:var(--text);
      font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans Thai","Noto Sans",Arial;
      background:
        radial-gradient(1200px 600px at 10% 0%, rgba(139,92,246,.15), transparent 50%),
        radial-gradient(1200px 700px at 90% 100%, rgba(55,48,163,.12), transparent 50%),
        linear-gradient(180deg, #0b0b1a 0%, #0c0d20 100%);
      overflow-x:hidden;
    }
    .frame {
      position: fixed; inset: 0; pointer-events:none;
    }
    .frame::before, .frame::after{
      content:""; position:absolute; top:0; bottom:0; width:14px;
      background:
        linear-gradient(180deg, rgba(167,139,250,.0), rgba(167,139,250,.35) 40%, rgba(139,92,246,.45), rgba(167,139,250,.2) 60%, rgba(167,139,250,.0));
      filter: blur(2px);
      animation: glow 3.6s linear infinite;
    }
    .frame::before{ left:18px }
    .frame::after{ right:18px; animation-delay:1.2s }
    @keyframes glow{
      0%{ opacity:.35 } 50%{ opacity:.85 } 100%{ opacity:.35 }
    }

    .wrap{max-width:1100px;margin:0 auto;padding:28px}
    header.hero{
      display:flex; gap:16px; align-items:center; justify-content:space-between; flex-wrap:wrap;
      padding:16px 8px 8px;
    }
    .title{font-size:28px; font-weight:800; letter-spacing:.4px}
    .subtitle{color:var(--muted); margin-top:4px}

    .card{
      background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.01)) , var(--panel);
      border:1px solid rgba(167,139,250,.25);
      border-radius:20px;
      box-shadow:0 20px 60px rgba(0,0,0,.35), inset 0 0 0 1px rgba(255,255,255,.02);
      overflow:hidden;
    }
    .row{display:flex; gap:16px; flex-wrap:wrap}
    .grow{flex:1}

    .drop{
      margin:16px; padding:20px; border-radius:16px;
      background:var(--soft);
      border:2px dashed rgba(167,139,250,.35);
      text-align:center;
      transition:.15s border-color, .15s background;
    }
    .drop.drag{ border-color:var(--accent); background:#0f1131 }
    .hint{font-size:12px; color:var(--muted)}

    .btn{
      appearance:none; border:none; cursor:pointer;
      padding:10px 14px; border-radius:12px; font-weight:600;
      background:linear-gradient(180deg, var(--accent), var(--accent-2));
      color:white; box-shadow:0 8px 20px rgba(139,92,246,.35);
      transition: transform .05s ease-in-out;
    }
    .btn:active{ transform: translateY(1px) }
    .btn.secondary{
      background:#1b1f3a; color:#e9e9f2; box-shadow:none; border:1px solid rgba(167,139,250,.25);
    }
    .toolbar{
      display:flex; gap:8px; justify-content:flex-end; padding:12px 16px; border-top:1px solid rgba(167,139,250,.18);
      background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,0));
    }

    .cols{ display:grid; grid-template-columns:1fr; gap:16px; padding:16px }
    @media (min-width:900px){ .cols{ grid-template-columns:1fr 1fr } }

    .panel{
      border:1px solid rgba(167,139,250,.22);
      border-radius:16px; overflow:hidden;
      background:linear-gradient(180deg, rgba(255,255,255,.015), rgba(255,255,255,0)) , #0f1229;
    }
    .panel header{
      padding:10px 14px; display:flex; align-items:center; justify-content:space-between;
      background:linear-gradient(180deg, rgba(167,139,250,.12), rgba(167,139,250,.04));
      border-bottom:1px solid rgba(167,139,250,.18);
    }
    .panel h3{ margin:0; font-size:16px; letter-spacing:.3px }
    .panel .body{ padding:12px }
    pre{
      margin:0; padding:14px; background:var(--code); border-radius:12px; overflow:auto;
      border:1px solid #1d2544; font-size:13px; line-height:1.45; color:#e6f3ff;
      box-shadow: inset 0 0 24px rgba(23,24,60,.5);
    }
    code{ font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace }

    .log{ padding:12px 16px; border-top:1px dashed rgba(167,139,250,.22); color:#c9d3ff; background:#0d1130 }
    .log .ok{ color:var(--ok) } .log .err{ color:var(--err) }

    .list{
      padding:10px 16px; border-top:1px solid rgba(167,139,250,.15);
      max-height:260px; overflow:auto; background:linear-gradient(180deg, rgba(255,255,255,.01), transparent);
    }
    .item{ display:flex; gap:10px; align-items:center; padding:8px 0; border-bottom:1px dashed rgba(167,139,250,.12)}
    .badge{ font-variant-numeric: tabular-nums; padding:2px 8px; border-radius:999px; background:#14183a; border:1px solid rgba(167,139,250,.25); color:#cbd5ff }

    .fade-in{ animation: fade .2s ease-out }
    @keyframes fade{ from{opacity:0; transform:translateY(4px)} to{opacity:1; transform:none} }
  </style>
</head>
<body>
  <div class="frame"></div>

  <div class="wrap">
    <header class="hero">
      <div>
        <div class="title">üß© Addon Injector Helper ‚Äî <span style="color:var(--accent)">BH/RS</span></div>
        <div class="subtitle">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏•‡∏≤‡∏¢‡πÅ‡∏≠‡∏î‡∏≠‡∏≠‡∏ô ‚Üí ‡∏î‡∏∂‡∏á UUID/Version ‡∏à‡∏≤‡∏Å <code>manifest.json</code> ‚Üí ‡∏û‡∏¥‡∏°‡∏û‡πå‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö <b>world_behavior_packs.json</b> ‡πÅ‡∏•‡∏∞ <b>world_resource_packs.json</b> ‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</div>
      </div>
      <div class="row">
        <button class="btn secondary" id="btnClear">‡∏•‡πâ‡∏≤‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå</button>
        <button class="btn" id="btnPick">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‚Ä¶</button>
        <input id="file" type="file" multiple hidden accept=".zip,.mcpack,.mcaddon,.json,application/zip,application/json"/>
      </div>
    </header>

    <section class="card">
      <div class="drop" id="drop">
        <div style="font-size:18px; font-weight:800; letter-spacing:.3px">‡∏•‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</div>
        <div class="hint" style="margin-top:6px">
          ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö .zip / .mcpack / .mcaddon / manifest.json (‡∏´‡∏•‡∏≤‡∏¢‡πÑ‡∏ü‡∏•‡πå‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô) ‚Ä¢ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ <code>manifest.json</code> ‡∏Ç‡πâ‡∏≤‡∏á‡πÉ‡∏ô‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
        </div>
      </div>

      <div class="list" id="list"></div>

      <div class="cols">
        <div class="panel">
          <header>
            <h3>world_behavior_packs.json</h3>
            <div class="row">
              <button class="btn secondary" id="copyBH">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å</button>
              <button class="btn secondary" id="downloadBH">‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î</button>
            </div>
          </header>
          <div class="body">
            <pre class="fade-in"><code id="outBH">[]</code></pre>
          </div>
        </div>
        <div class="panel">
          <header>
            <h3>world_resource_packs.json</h3>
            <div class="row">
              <button class="btn secondary" id="copyRS">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å</button>
              <button class="btn secondary" id="downloadRS">‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î</button>
            </div>
          </header>
          <div class="body">
            <pre class="fade-in"><code id="outRS">[]</code></pre>
          </div>
        </div>
      </div>

      <div class="toolbar">
        <span class="hint">Tip: ‡∏Ñ‡∏•‡∏¥‡∏Å ‚Äú‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‚Äù ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏≠‡∏≤‡πÑ‡∏õ‡∏ß‡∏≤‡∏á‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå‡πÇ‡∏•‡∏Å‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ ‚Ä¢ ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏û‡πá‡∏Å (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏ó‡∏¢) ‚Üí ‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏°‡∏≤‡∏Å‚Üí‡∏ô‡πâ‡∏≠‡∏¢</span>
      </div>

      <div class="log" id="log">‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô ‚ú®</div>
    </section>
  </div>

  <!-- JSZip -->
  <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js" crossorigin="anonymous"></script>
  <script>
    const drop = document.getElementById('drop');
    const input = document.getElementById('file');
    const pick = document.getElementById('btnPick');
    const clearBtn = document.getElementById('btnClear');
    const logEl = document.getElementById('log');
    const listEl = document.getElementById('list');

    const outBH = document.getElementById('outBH');
    const outRS = document.getElementById('outRS');

    const copyBH = document.getElementById('copyBH');
    const copyRS = document.getElementById('copyRS');
    const dlBH = document.getElementById('downloadBH');
    const dlRS = document.getElementById('downloadRS');

    // store by pack_id (avoid duplicates)
    const BH = new Map(); // {pack_id,version,name,from}
    const RS = new Map();

    function log(msg, cls){
      logEl.innerHTML = (cls==='err' ? '‚ùå ' : cls==='ok' ? '‚úÖ ' : '‚Ä¢ ') + msg;
      if (cls) logEl.className = 'log ' + cls;
      else logEl.className = 'log';
    }

    function decodeUnicodeEscapes(str){
      try { return /\\u[0-9a-fA-F]{4}/.test(str) ? str.replace(/\\u([0-9a-fA-F]{4})/g, (_,g1)=>String.fromCharCode(parseInt(g1,16))) : str; }
      catch { return str; }
    }

    function addItemLine({name, pack_id, version, from, type}){
      const line = document.createElement('div');
      line.className = 'item fade-in';
      line.innerHTML = `
        <span class="badge">${type}</span>
        <div class="grow">
          <div style="font-weight:700">${decodeUnicodeEscapes(name||'(‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏)')}</div>
          <div class="hint">UUID: <code>${pack_id}</code> ‚Ä¢ version: <code>[${version.join(', ')}]</code> ‚Ä¢ <span>${from}</span></div>
        </div>
      `;
      listEl.appendChild(line);
    }

    function prettySort(arr){
      arr.sort((a,b)=>{
        const nameCmp = (a.name||'').toString().localeCompare((b.name||'').toString(),'th');
        if (nameCmp!==0) return nameCmp;
        const av=a.version||[], bv=b.version||[];
        for(let i=0;i<Math.max(av.length,bv.length);i++){
          const ai=av[i]??0, bi=bv[i]??0;
          if (ai!==bi) return bi-ai;
        }
        return a.pack_id.localeCompare(b.pack_id);
      });
      return arr;
    }

    function toArray(map){ return Array.from(map.values()); }

    async function typeOut(el, text){
      // ‚Äú‡∏Ñ‡πà‡∏≠‡∏¢‡πÜ ‡∏û‡∏¥‡∏°‡∏û‡πå‚Äù ‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå
      el.textContent = '';
      const delay = 6; // ms ‡∏ï‡πà‡∏≠ char
      for (let i=0;i<text.length;i++){
        el.textContent += text[i];
        if (i % 4 === 0) await new Promise(r=>setTimeout(r, delay));
      }
    }

    function buildJSON(){
      const bhArr = prettySort(toArray(BH)).map(({pack_id,version})=>({pack_id,version}));
      const rsArr = prettySort(toArray(RS)).map(({pack_id,version})=>({pack_id,version}));
      return { bhText: JSON.stringify(bhArr, null, 2), rsText: JSON.stringify(rsArr, null, 2) };
    }

    async function refreshOutputs(){
      const { bhText, rsText } = buildJSON();
      await typeOut(outBH, bhText);
      await typeOut(outRS, rsText);
      log('‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß ‚ú® ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡πä‡∏≠‡∏õ BH/RS ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢', 'ok');
    }

    function isZipLike(name, type){
      const n=(name||'').toLowerCase();
      return type==='application/zip' || /\.(zip|mcpack|mcaddon)$/.test(n);
    }

    async function parseManifestText(text){
      let obj;
      try { obj = JSON.parse(text); }
      catch {
        // double-encoded fallback
        try{
          const fixed = text.replace(/^\\s*"|"\\s*$/g,'').replace(/\\n/g,'\\n');
          obj = JSON.parse(JSON.parse('"' + fixed.replace(/"/g,'\\"') + '"'));
        }catch{ throw new Error('‡∏≠‡πà‡∏≤‡∏ô JSON ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ'); }
      }
      return obj;
    }

    function classifyModules(mods){
      // returns {isBH, isRS}
      let isBH=false, isRS=false;
      if (Array.isArray(mods)){
        for(const m of mods){
          const t = (m?.type||'').toLowerCase();
          if (t==='data' || t==='script') isBH = true;
          if (t==='resources' || t==='client_data') isRS = true;
        }
      }
      return {isBH, isRS};
    }

    async function processFile(file){
      // direct manifest
      if (/manifest\.json$/i.test(file.name)){
        const text = await file.text();
        await handleManifest(await parseManifestText(text), file.name);
        return;
      }
      if (!isZipLike(file.name, file.type)){
        throw new Error('‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ (‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô .zip/.mcpack/.mcaddon ‡∏´‡∏£‡∏∑‡∏≠ manifest.json)');
      }
      log('‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå: ' + file.name + ' ‚Ä¶');
      const zip = await JSZip.loadAsync(file);
      const entry = Object.values(zip.files).find(f => /(^|\/)manifest\.json$/i.test(f.name));
      if (!entry) throw new Error('‡πÑ‡∏°‡πà‡∏û‡∏ö manifest.json ‡∏Ç‡πâ‡∏≤‡∏á‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå');
      const text = await entry.async('text');
      await handleManifest(await parseManifestText(text), `${file.name} ‚Üí ${entry.name}`);
    }

    async function handleManifest(obj, fromName){
      const header = obj?.header || {};
      const uuid = header.uuid || header.pack_id || obj?.header?.pack_id;
      const version = header.version || header.pack_version || obj?.header?.pack_version;
      const name = header.name || header.pack_name || 'Unknown';
      const modules = obj?.modules || obj?.module || [];

      if (!uuid || !version) throw new Error('‡πÑ‡∏°‡πà‡∏û‡∏ö uuid/version ‡πÉ‡∏ô manifest');

      const pack_id = String(uuid);
      const verArr = Array.isArray(version) ? version.map(Number) : String(version).split('.').map(Number);

      const {isBH, isRS} = classifyModules(modules);
      // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏±‡∏î (‡∏ö‡∏≤‡∏á‡πÅ‡∏û‡πá‡∏Å‡πÄ‡∏Å‡πà‡∏≤) ‡πÉ‡∏´‡πâ‡∏ñ‡∏∑‡∏≠‡πÄ‡∏õ‡πá‡∏ô RS ‡πÇ‡∏î‡∏¢‡∏î‡∏µ‡∏ü‡∏≠‡∏•‡∏ï‡πå
      const atLeastOne = isBH || isRS ? null : (isRS = true);

      if (isBH){
        BH.set(pack_id, { pack_id, version:verArr, name, from:fromName });
        addItemLine({name, pack_id, version:verArr, from:fromName, type:'BH'});
      }
      if (isRS){
        RS.set(pack_id, { pack_id, version:verArr, name, from:fromName });
        addItemLine({name, pack_id, version:verArr, from:fromName, type:'RS'});
      }
      await refreshOutputs();
    }

    async function handleFiles(fileList){
      const files = Array.from(fileList);
      if (!files.length) return;
      listEl.innerHTML = '';
      log('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‚Ä¶');
      for (const file of files){
        try{ await processFile(file); }
        catch(e){ log((file.name? file.name+': ' : '') + (e?.message||e), 'err'); }
      }
      if (!BH.size && !RS.size){
        log('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÅ‡∏û‡πá‡∏Å‡∏ó‡∏µ‡πà‡∏î‡∏∂‡∏á‡πÑ‡∏î‡πâ ‡∏•‡∏≠‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏≠‡∏∑‡πà‡∏ô‡∏î‡∏π‡∏ô‡∏∞', 'err');
      }
    }

    // Copy/Download
    async function copy(text){
      try{ await navigator.clipboard.writeText(text); log('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß ‚úÖ', 'ok'); }
      catch{ log('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏•‡∏≠‡∏á‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á', 'err'); }
    }
    function download(text, name){
      const blob = new Blob([text], {type:'application/json'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = name;
      a.click();
      URL.revokeObjectURL(a.href);
    }

    copyBH.onclick = ()=> copy(outBH.textContent);
    copyRS.onclick = ()=> copy(outRS.textContent);
    dlBH.onclick = ()=> download(outBH.textContent, 'world_behavior_packs.json');
    dlRS.onclick = ()=> download(outRS.textContent, 'world_resource_packs.json');

    // Drag & Drop
    ['dragenter','dragover'].forEach(ev=>drop.addEventListener(ev, e=>{
      e.preventDefault(); drop.classList.add('drag');
    }));
    ['dragleave','drop'].forEach(ev=>drop.addEventListener(ev, e=>{
      e.preventDefault(); drop.classList.remove('drag');
    }));
    drop.addEventListener('drop', (e)=> handleFiles(e.dataTransfer.files));

    // File picker
    pick.onclick = ()=> input.click();
    input.onchange = ()=> handleFiles(input.files);

    clearBtn.onclick = ()=>{
      BH.clear(); RS.clear();
      outBH.textContent = '[]'; outRS.textContent = '[]';
      listEl.innerHTML = ''; log('‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß');
    };

    log('‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô ‚ú®');
  </script>
</body>
</html>
